<!DOCTYPE html><html lang="ko" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="방문자 패턴" /><meta property="og:locale" content="ko" /><meta name="description" content="방문자 패턴" /><meta property="og:description" content="방문자 패턴" /><link rel="canonical" href="https://yjh9317.github.io/posts/%EB%B0%A9%EB%AC%B8%EC%9E%90-%ED%8C%A8%ED%84%B4/" /><meta property="og:url" content="https://yjh9317.github.io/posts/%EB%B0%A9%EB%AC%B8%EC%9E%90-%ED%8C%A8%ED%84%B4/" /><meta property="og:site_name" content="yjh9317" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-07T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="방문자 패턴" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-17T15:34:32+09:00","datePublished":"2023-07-07T00:00:00+09:00","description":"방문자 패턴","headline":"방문자 패턴","mainEntityOfPage":{"@type":"WebPage","@id":"https://yjh9317.github.io/posts/%EB%B0%A9%EB%AC%B8%EC%9E%90-%ED%8C%A8%ED%84%B4/"},"url":"https://yjh9317.github.io/posts/%EB%B0%A9%EB%AC%B8%EC%9E%90-%ED%8C%A8%ED%84%B4/"}</script><title>방문자 패턴 | yjh9317</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="yjh9317"><meta name="application-name" content="yjh9317"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> </a></div><div class="site-title mt-3"> <a href="/">yjh9317</a></div><div class="site-subtitle font-italic">코딩열심히하려는사람</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yjh9317" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>방문자 패턴</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>방문자 패턴</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1688655600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 7, 2023 </em> </span> <span> Updated <em class="" data-ts="1750142072" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 17, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Yang jeong hyeon</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2165 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h1 id="방문자-패턴">방문자 패턴</h1><ul><li><p>실제 데이터 구조(객체들의 집합)와, 그 구조를 순회하며 수행할 <strong>처리 로직(알고리즘)</strong>을 분리하는 행위 디자인 패턴</p><li>이 패턴을 사용하면, 데이터 구조를 변경하지 않고도 새로운 연산(기능)을 쉽게 추가할 수 있다.<li><p>‘방문자(Visitor)’라는 객체가 데이터 구조의 각 요소를 ‘방문’하면서, 각 요소에 맞는 특정 작업을 수행하는 방식이다.</p><li>게임 씬(Scene)에 존재하는 다양한 오브젝트들을 JSON, XML 등 여러 포맷으로 저장하는 기능을 추가해야 할 때, 각 오브젝트 클래스에 SaveToJson(), SaveToXml() 같은 메서드를 일일이 추가하는 대신, JsonVisitor, XmlVisitor를 만들어 이 문제를 깔끔하게 해결할 수 있다.</ul><h2 id="시나리오-게임-씬scene을-다양한-포맷으로-저장하기"><span class="mr-2">시나리오: 게임 씬(Scene)을 다양한 포맷으로 저장하기</span><a href="#시나리오-게임-씬scene을-다양한-포맷으로-저장하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p>게임 씬은 여러 종류의 노드(Node)들이 트리 구조(씬 그래프)를 이루고 있다고 가정하자.</p><ul><li>TransformNode: 다른 노드들을 자식으로 가질 수 있는 그룹 노드. 위치, 회전, 크기 정보를 가진다.<li>MeshNode: 3D 모델을 나타내는 말단 노드(Leaf).<li>LightNode: 광원을 나타내는 말단 노드.</ul><li><p>이 씬 그래프 구조는 안정적이어서 거의 변하지 않지만, 앞으로 이 씬을 JSON, XML, 혹은 커스텀 바이너리 포맷 등 다양한 방식으로 저장하는 기능이 계속 추가될 예정이다.</p></ul><h3 id="문제점-침습적-방식의-한계"><span class="mr-2">문제점: 침습적 방식의 한계</span><a href="#문제점-침습적-방식의-한계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>가장 단순한 방법은 ISceneNode 인터페이스에 SaveToJson(), SaveToXml() 같은 가상 함수를 추가하고, 모든 하위 클래스에서 이를 구현하는 것이다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// 안티 패턴: 새로운 기능이 추가될 때마다 모든 클래스를 수정해야 한다.</span>
<span class="k">class</span> <span class="nc">ISceneNode</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">SaveToJson</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">SaveToXml</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// ... 새로운 저장 포맷이 추가될 때마다 여기에 메서드가 늘어난다.</span>
<span class="p">};</span>
</pre></table></code></div></div><ul><li>이 방식은 <strong>개방-폐쇄 원칙(OCP)</strong>을 위배한다. 새로운 저장 기능이 하나 추가될 때마다 ISceneNode를 포함한 모든 노드 클래스의 코드를 수정해야 한다.<li>또한 각 노드 클래스가 렌더링, 물리, 저장 등 너무 많은 책임을 지게 되어 <strong>단일 책임 원칙(SRP)</strong>도 위배한다.</ul><h2 id="해결책-방문자-패턴-도입"><span class="mr-2">해결책: 방문자 패턴 도입</span><a href="#해결책-방문자-패턴-도입" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>방문자 패턴은 <strong>이중 디스패치(Double Dispatch)</strong>라는 기법을 활용하여 이 문제를 해결한다.<li>이중 디스패치란, 프로그램의 실제 동작이 두 객체의 런타임 타입에 따라 결정되게 하는 것이다.</ul><h3 id="1-방문자visitor-인터페이스-정의"><span class="mr-2">1. 방문자(Visitor) 인터페이스 정의</span><a href="#1-방문자visitor-인터페이스-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>먼저, 씬 그래프의 각 노드 타입을 ‘방문’할 수 있는 메서드를 가진 INodeVisitor 인터페이스를 정의한다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="c1">// 전방 선언</span>
<span class="k">class</span> <span class="nc">TransformNode</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">MeshNode</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">LightNode</span><span class="p">;</span>

<span class="c1">// 방문자 인터페이스: 방문할 모든 노드 타입에 대한 Visit 메서드를 정의한다.</span>
<span class="k">class</span> <span class="nc">INodeVisitor</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">INodeVisitor</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">TransformNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">MeshNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">LightNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="2-데이터-구조에-accept-메서드-추가"><span class="mr-2">2. 데이터 구조에 Accept 메서드 추가</span><a href="#2-데이터-구조에-accept-메서드-추가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>이제 각 노드 클래스가 방문자를 ‘받아들일’ 수 있도록 Accept 메서드를 추가한다.<li>이것이 이중 디스패치의 첫 번째 단계다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// 데이터 구조의 기본 인터페이스</span>
<span class="k">class</span> <span class="nc">ISceneNode</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">ISceneNode</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="c1">// 모든 노드는 방문자를 받아들여야 한다.</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Accept</span><span class="p">(</span><span class="n">INodeVisitor</span><span class="o">&amp;</span> <span class="n">visitor</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MeshNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ISceneNode</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="c1">// MeshNode는 방문자에게 "나는 MeshNode야"라고 알리며 자신을 전달한다.</span>
    <span class="kt">void</span> <span class="n">Accept</span><span class="p">(</span><span class="n">INodeVisitor</span><span class="o">&amp;</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">visitor</span><span class="p">.</span><span class="n">Visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="c1">// 이중 디스패치의 두 번째 단계</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TransformNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ISceneNode</span> <span class="p">{</span> <span class="cm">/* ... */</span>
    <span class="kt">void</span> <span class="n">Accept</span><span class="p">(</span><span class="n">INodeVisitor</span><span class="o">&amp;</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">visitor</span><span class="p">.</span><span class="n">Visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">LightNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ISceneNode</span> <span class="p">{</span> <span class="cm">/* ... */</span>
    <span class="kt">void</span> <span class="n">Accept</span><span class="p">(</span><span class="n">INodeVisitor</span><span class="o">&amp;</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">visitor</span><span class="p">.</span><span class="n">Visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><ul><li>node-&gt;Accept(visitor)가 호출되면, 먼저 node의 실제 타입에 따라 올바른 Accept 메서드가 호출된다(첫 번째 디스패치).<li>그리고 그 Accept 메서드 안에서 visitor.Visit(*this)가 호출되는데, 이때 *this의 타입은 컴파일 타임에 확정되므로, INodeVisitor에 오버로딩된 Visit 메서드 중 정확한 타입의 것이 호출된다(두 번째 디스패치).</ul><h3 id="3-구체적인-방문자concrete-visitor-구현"><span class="mr-2">3. 구체적인 방문자(Concrete Visitor) 구현</span><a href="#3-구체적인-방문자concrete-visitor-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>이제 새로운 ‘저장’ 기능을 별도의 방문자 클래스로 구현한다. ISceneNode 계층의 코드는 전혀 건드릴 필요가 없다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1">// 구체적인 방문자: JSON으로 저장하는 로직을 담당한다.</span>
<span class="k">class</span> <span class="nc">JsonSaveVisitor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">INodeVisitor</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">string</span> <span class="n">json_output</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">TransformNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">json_output</span> <span class="o">+=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Transform</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">children</span><span class="se">\"</span><span class="s">: ["</span><span class="p">;</span>
        <span class="c1">// 자식 노드들을 재귀적으로 방문한다.</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">child</span> <span class="o">:</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">child</span><span class="o">-&gt;</span><span class="n">Accept</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">json_output</span> <span class="o">+=</span> <span class="s">"] }"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">MeshNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">json_output</span> <span class="o">+=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Mesh</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">path</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">node</span><span class="p">.</span><span class="n">meshPath</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> }"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Visit</span><span class="p">(</span><span class="n">LightNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
        <span class="n">json_output</span> <span class="o">+=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">type</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Light</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">intensity</span><span class="se">\"</span><span class="s">: "</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">intensity</span><span class="p">)</span> <span class="o">+</span> <span class="s">" }"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">string</span> <span class="n">GetResult</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">json_output</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="4-클라이언트-코드에서의-활용"><span class="mr-2">4. 클라이언트 코드에서의 활용</span><a href="#4-클라이언트-코드에서의-활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>클라이언트는 원하는 방문자 객체를 생성하고, 씬 그래프의 루트 노드에 전달하기만 하면 된다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 1. 씬 그래프를 구성한다.</span>
    <span class="k">auto</span> <span class="n">scene_root</span> <span class="o">=</span> <span class="n">make_unique</span><span class="o">&lt;</span><span class="n">TransformNode</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="n">scene_root</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MeshNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"player.obj"</span><span class="p">));</span>
    <span class="n">scene_root</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">LightNode</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.5</span><span class="n">f</span><span class="p">));</span>

    <span class="c1">// 2. JSON 저장 방문자를 생성하고 실행한다.</span>
    <span class="n">JsonSaveVisitor</span> <span class="n">json_visitor</span><span class="p">;</span>
    <span class="n">scene_root</span><span class="o">-&gt;</span><span class="n">Accept</span><span class="p">(</span><span class="n">json_visitor</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"JSON 저장 결과: "</span> <span class="o">&lt;&lt;</span> <span class="n">json_visitor</span><span class="p">.</span><span class="n">GetResult</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="c1">// 만약 XML 저장이 필요하다면?</span>
    <span class="c1">// XmlSaveVisitor xml_visitor;</span>
    <span class="c1">// scene_root-&gt;Accept(xml_visitor);</span>
    <span class="c1">// -&gt; 오직 새로운 방문자 클래스만 추가하면 된다!</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="현대적-대안-stdvariant와-stdvisit"><span class="mr-2">현대적 대안: std::variant와 std::visit</span><a href="#현대적-대안-stdvariant와-stdvisit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>C++17 이상에서는 std::variant를 사용하여 방문자 패턴을 더 안전하고 간결하게 구현할 수 있다.<li>variant는 타입 안전한 union으로, 정해진 타입 목록 중 하나를 저장할 수 있다.</ul><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp">
</span>
<span class="c1">// 1. 상속 대신 variant로 노드 타입을 정의한다.</span>
<span class="k">using</span> <span class="n">SceneNode</span> <span class="o">=</span> <span class="n">variant</span><span class="o">&lt;</span><span class="n">TransformNode</span><span class="p">,</span> <span class="n">MeshNode</span><span class="p">,</span> <span class="n">LightNode</span><span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// 2. 방문자는 각 타입에 대한 operator() 오버로드를 가진다.</span>
<span class="k">struct</span> <span class="nc">SaveVisitor</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">TransformNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">MeshNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">LightNode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SceneNode</span> <span class="n">node</span> <span class="o">=</span> <span class="n">MeshNode</span><span class="p">{</span><span class="s">"enemy.obj"</span><span class="p">};</span>

    <span class="c1">// 3. std::visit가 알아서 node의 현재 타입에 맞는 operator()를 호출해준다.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">SaveVisitor</span><span class="p">{},</span> <span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li>이 방식은 Accept 메서드를 추가하기 위해 데이터 구조를 수정할 필요가 없고, 컴파일 타임에 모든 타입을 처리하는지 검사할 수 있어 더 안전하다.<li>하지만 variant에 새로운 타입을 추가하는 것은 여전히 모든 방문자를 수정해야 하는 번거로움이 있다.</ul><h1 id="요약">요약</h1><ul><li><p>방문자 패턴은 데이터 구조와 이를 처리하는 <strong>알고리즘(연산)</strong>을 분리하는 강력한 패턴이다.</p><li><p>이 패턴을 사용하면, 기존 데이터 구조의 코드를 변경하지 않고도 새로운 연산을 쉽게 추가할 수 있다 (개방-폐쇄 원칙).</p><li>구성 요소:<ul><li><p>Element: 데이터 구조의 각 요소. 방문자를 받아들이는 Accept 메서드를 가진다.</p><li><p>Visitor: 데이터 구조의 각 요소를 방문하는 Visit 메서드를 정의한 인터페이스.</p><li><p>ConcreteVisitor: Visitor 인터페이스를 구현하여 실제 연산을 수행하는 클래스.</p></ul><li>단점: 데이터 구조에 새로운 Element 타입을 추가하기가 어렵다. 새로운 요소가 추가되면 모든 Visitor 인터페이스와 구현체를 수정해야 하기 때문이다. 따라서 데이터 구조는 안정적이지만, 수행할 연산이 자주 변경되거나 추가될 때 가장 효과적이다.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4/'>디자인 패턴</a>, <a href='/categories/%ED%96%89%ED%83%9C-%ED%8C%A8%ED%84%B4/'>행태 패턴</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/design-pattern/" class="post-tag no-text-decoration" >design pattern</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EB%B0%A9%EB%AC%B8%EC%9E%90+%ED%8C%A8%ED%84%B4+-+yjh9317&url=https%3A%2F%2Fyjh9317.github.io%2Fposts%2F%25EB%25B0%25A9%25EB%25AC%25B8%25EC%259E%2590-%25ED%258C%25A8%25ED%2584%25B4%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EB%B0%A9%EB%AC%B8%EC%9E%90+%ED%8C%A8%ED%84%B4+-+yjh9317&u=https%3A%2F%2Fyjh9317.github.io%2Fposts%2F%25EB%25B0%25A9%25EB%25AC%25B8%25EC%259E%2590-%25ED%258C%25A8%25ED%2584%25B4%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyjh9317.github.io%2Fposts%2F%25EB%25B0%25A9%25EB%25AC%25B8%25EC%259E%2590-%25ED%258C%25A8%25ED%2584%25B4%2F&text=%EB%B0%A9%EB%AC%B8%EC%9E%90+%ED%8C%A8%ED%84%B4+-+yjh9317" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Gameplay-Param/">GameplayTag Param</a><li><a href="/posts/Device/">Device</a><li><a href="/posts/SwapChain/">SwapChain</a><li><a href="/posts/VertexBuffer/">VertexBuffer</a><li><a href="/posts/IndexBuffer/">IndexBuffer</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/unreal/">unreal</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/directx/">directx</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/data-structure/">data_structure</a> <a class="post-tag" href="/tags/modern-effective-c/">modern effective c++</a> <a class="post-tag" href="/tags/directx3d/">directx3d</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%EC%B1%85%EC%9E%84-%EC%82%AC%EC%8A%AC-%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1685631600" data-df="ll" > Jun 2, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>책임 사슬 패턴</h3><div class="text-muted small"><p> 책임 사슬 패턴 요청을 처리할 수 있는 객체들의 사슬(chain)을 만들어, 요청이 처리될 때까지 이 사슬을 따라 객체들이 차례대로 요청을 확인하게 만드는 행위 디자인 패턴이다. 요청을 보낸 객체(Sender)는 어떤 객체가 그 요청을 처리할지 알 필요가 없다. 요청은 사슬의 첫 번째 객체에게 전달되고, 해당 객체는 요청을 처...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%BB%A4%EB%A7%A8%EB%93%9C-%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1685890800" data-df="ll" > Jun 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>커맨드 패턴</h3><div class="text-muted small"><p> 커맨드 패턴 player.Jump()처럼 객체의 메서드를 직접 호출하는 대신, ‘점프하라’는 요청(request) 또는 명령(command) 자체를 하나의 객체로 캡슐화하는 것이 커맨드 패턴(Command Pattern)의 핵심이다. 이렇게 요청을 객체로 만들면 어떤 장점이 있을까? 명령을 변수처럼 저장하거나, 큐에 ...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%9D%B8%ED%84%B0%ED%94%84%EB%A6%AC%ED%84%B0-%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1686150000" data-df="ll" > Jun 8, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>인터프리터 패턴</h3><div class="text-muted small"><p> 인터프리터 패턴 특정 ‘언어’에 대한 문법을 정의하고, 그 언어로 작성된 문장을 해석(interpret)하는 해석기를 제공하는 행위 디자인 패턴 쉽게 말해, 우리가 직접 정의한 간단한 규칙이나 언어를 이해하고 실행하는 엔진을 만드는 방법이다. 게임 개발에서는 NPC의 행동을 정의하는 간단한 스크립트, 퀘스트의 완료...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%EB%A9%80%ED%8B%B0-%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%EA%B0%9C%EB%85%90/" class="btn btn-outline-primary" prompt="Older"><p>멀티 플레이어 개념</p></a> <a href="/posts/%EB%A9%80%ED%8B%B0%ED%94%8C%EB%A0%88%EC%9D%B4%EC%96%B4-%ED%85%8C%EC%8A%A4%ED%8A%B8/" class="btn btn-outline-primary" prompt="Newer"><p>멀티 플레이어 테스트</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Yang jeong hyeon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/unreal/">unreal</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/design-pattern/">design pattern</a> <a class="post-tag" href="/tags/coding-test/">coding test</a> <a class="post-tag" href="/tags/directx/">directx</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/data-structure/">data_structure</a> <a class="post-tag" href="/tags/modern-effective-c/">modern effective c++</a> <a class="post-tag" href="/tags/directx3d/">directx3d</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
