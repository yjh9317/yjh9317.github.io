---
title: Delegate
date: 2023-07-09
categories: [unreal,unreal]
tags: [unreal]		# TAG는 반드시 소문자로 이루어져야함!
---

Delegate
================

* `Delegate는 어떤 오브젝트의 멤버 함수를 다른 오브젝트에게 동적으로 바인딩(binding)시키면, 다른 오브젝트에서 그 멤버 함수를 호출할 수 있도록 하는 기법이다.`

* Delegate는 관찰자 패턴이라는 디자인 패턴에서 관찰자가 피관찰자에게 어떤 이벤트에 대한 반응으로 콜백 함수를 호출시키는 방식으로도 사용된더.

  * 이 디자인 패턴의 장점은 `관찰자와 피관찰자를 1:1관계로 만들어 준다는 것이다.`

  * 관찰자는 피관찰자의 목록을 멤버 변수로 두고 관찰자에게 신호를 주면 관찰자는 피관찰자들에게 `Broadcast(방송)`을 하여 피관찰자들에게 바인딩한 멤버 함수를 호출시킨다.


<br>

**다이나믹 델리게이트 선언**
==============

```c++
// 다이내믹 싱글 델리게이트 선언
DECLARE_DYNAMIC_DELEGATE(FDynamicDele)

// 다이내믹 멀티캐스트 델리게이트 선언
DECLARE_DYNAMIC_MULTICAST_DELEGATE(FDynamicMultiDele)

// 하나의 인자를 가지는 다이내믹 멀티캐스트 델리게이트 선언
DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FDynamicMultiDele_OneParam, int) 
```

* `DECLARE_DYNAMIC_DELEGATE`은 `Single Delegate`으로 하나의 함수만 바인딩할 수 있다.

* `DECLARE_DYNAMIC_MULTICAST_DELEGATE`은 `Multi Delegate`으로 여러개의 함수를 바인딩할 수 있다.

* `DELEGATE_OneParam`, `DELEGATE_TwoParam`등 DELEGATE 뒤에 영어로 인자 개수를 설정하여 Delegate에 바인딩할 함수의 인자로 사용할 수 있다.

  * `선언할 때의 순서와 사용할 때의 순서는 일치해야 한다.`

<br>

**다이나믹 게이트 바인딩**
==========

```c++
// 아래 함수들은 Helper 매크로

// Single Delegate에서 사용
BindDynamic(UserObject, FuncName);

// Multi Delegate에서 사용
AddDynamic(UserObject, FuncName);

// 바인딩된 Delegate를 삭제
RemoveDynamic(UserObject, FuncName);
```


**다이나믹 게이트 실행**
=======

```c++
// Single Delegate에서 사용하는 함수들
Execute();          // 바인딩된 함수를 실행

ExecuteIfBound();   // 바인딩이 되어있는지 확인하고 됐으면 함수 실행

IsBound();          // 바인딩을 검사하는 함수


// Multi Delegate에서 사용하는 함수
Broadcast();        // Delegate에 바인딩된 모든 오브젝트에게 알려, 모두 호출시키도록 만든다
```

<br>

**예시**
=============

* 예비군 갔다와서 추가할 예정...


<br>

**많이 사용되는 컴포넌트 충돌**
==========

* 대표적인 예로는 SphereComponent같은 충돌처리를 할 때 많이 사용된다.

```c++
//Item.h

UFUNCTION()
virtual void OnSphereOverlap(UPrimitiveComponent* OverlappedComponent,
AActor* OtherActor,
UPrimitiveComponent* OtherComp,
int32 OtherBodyIndex,
bool bFromSweep,
const FHitResult& SweepResult);

UFUNCTION()
virtual void OnSphereEndOverlap(UPrimitiveComponent* OverlappedComponent,
AActor* OtherActor,
UPrimitiveComponent* OtherComp,
int32 OtherBodyIndex);

//Item.cpp
void AItem::BeginPlay()
{
	Super::BeginPlay();
	
    // SphereComponent에게 충돌이 일어나면 OnSphereOverlap이라는 함수를 발생시킨다
	Sphere->OnComponentBeginOverlap.AddDynamic(this,&AItem::OnSphereOverlap);

    // SphereComponent에게 충돌이 끝나면 OnSphereEndOverlap이라는 함수를 발생시킨다
	Sphere->OnComponentEndOverlap.AddDynamic(this,&AItem::OnSphereEndOverlap);
}

void AItem::OnSphereOverlap(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor,
	UPrimitiveComponent* OtherComp, int32 OtherBodyIndex, bool bFromSweep, const FHitResult& SweepResult)
{
    ... // 충돌할 때의 코드
}

void AItem::OnSphereEndOverlap(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor,
	UPrimitiveComponent* OtherComp, int32 OtherBodyIndex)
{
	... // 충돌이 벗어났을 때의 코드
}


// PrimitiveComponent.h
UPROPERTY(BlueprintAssignable, Category="Collision")
FComponentBeginOverlapSignature OnComponentBeginOverlap;

UPROPERTY(BlueprintAssignable, Category="Collision")
FComponentEndOverlapSignature OnComponentEndOverlap;

/** Delegate for notification of start of overlap with a specific component */
DECLARE_DYNAMIC_MULTICAST_SPARSE_DELEGATE_SixParams(FComponentBeginOverlapSignature,
UPrimitiveComponent,OnComponentBeginOverlap,
UPrimitiveComponent*,OverlappedComponent,
AActor*, OtherActor,
UPrimitiveComponent*, OtherComp,
int32, OtherBodyIndex,
bool, bFromSweep,
const FHitResult &,
SweepResult);

/** Delegate for notification of end of overlap with a specific component */
DECLARE_DYNAMIC_MULTICAST_SPARSE_DELEGATE_FourParams(FComponentEndOverlapSignature, UPrimitiveComponent,OnComponentEndOverlap,
UPrimitiveComponent*,OverlappedComponent,
AActor*,OtherActor,
UPrimitiveComponent*, OtherComp,
int32, OtherBodyIndex);
```

* Component들은 대체로 `PrimitiveComponent라는 최상위 컴포넌트에서 정의되어 있는 Delegate`와 `OnComponentBeginOverlap() 함수`를 사용하여 충돌 처리에 사용한다
  * `OnComponentBeginOverlap()는 콜백 함수`

* OnComponentBeginOverlap를 Delegate로 사용하기 위해선 해당 클래스의 헤더파일에서 OnComponentBeginOverlap를 선언해야 한다.



