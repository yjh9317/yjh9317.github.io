---
title: 퍼사드 패턴
date: 2023-05-21
categories: [디자인 패턴, 구조 패턴]
tags: [design pattern]		# TAG는 반드시 소문자로 이루어져야함!
---

프롤로그
==============

* 퍼사드는 프랑스어로 출입구가 있는 건물의 앞부분을 의미한다.

* 설명을 위해 예시를 들겠다.

<br>

예시
------------

* 만약 투자 관련 업무를 하기 위해 금융 거래 프로그램을 만든다면 필요한 정보들을 거래자 빠르게 제공할 수 있어야 한다.

* 상품들의 가격 변화가 일체의 지연없이 즉시 화면에 업데이트되어야 한다.

* 대부분의 금융 데이터들은 평범한 문자로 렌더링된다.
  * 예를 들어 검은 배경에 흰 글씨

* 운영 체제에서 제공하는 터미널/콘솔의 커맨드 라인 인터페이스와 비슷하지만 미묘한 차이가 있다.

<br><br>

터미널은 어떻게 작동할까?
===============

버퍼
---------

* 터미널 윈도우의 첫 번째 구성 요소는 버퍼이다.

* 버퍼에는 렌더링할 문자들이 저장되고 메모리의 사각형 공간으로 보통 char/wchar_t 타입의 1차원 or 2차원 배열로 만들어진다.

* 버퍼는 콘솔에서 눈에 보여지는 공간보다 훨씬 클 수 있다.

* 과거의 출력 히스토리를 저장하고 있어 이전 화면으로 스크롤하여 내용을 다시 확인할 수 있다.

<br>

뷰포트
------

* 버퍼는 보통 현재 입력 라인을 가리키는 어떤 표시를 가진다(보통 정숫값)

* 그 표시를 이용해 버퍼가 가득차면, 항상 새로운 라인을 할당하는 것이 아닌 가장 오래된 라인부터 덮어쓰면서 새로운 데이터를 받아들인다.

* 다음으로 뷰포트라는 개념이 등장한다.

* 뷰포트는 버퍼의 특정 영역을 화면에 렌더링한다.

* 버퍼는 보통 매우 커서 뷰포트는 버퍼의 작은 사각형 영역만 취하여 렌더링한다.

  * 당연하게도 뷰포트는 버퍼의 크기보다 작거나 같다.


콘솔(터미널 윈도)
-------------------

* 콘솔은 뷰포트를 화면에 보여주고 사용자로부터 입력을 받는다.

* 콘솔은 퍼사드의 역할이다.

* 뒤에서 일어나는 복잡한 작업들을 단순화하여 표현한다.

<br>

* 대부분의 경우 사용자는 하나의 버퍼와 하나의 뷰포트를 이용한다

* 하지만 콘솔 윈도를 세로로 분할하여 뷰포트 두 개를 두고 각각의 뷰포트가 자기만의 버퍼를 가지게 할 수도 있다.

* 리눅스에서는 screen 커맨드를 이용하여 그렇나 콘솔 윈도를 만들 수 있다.

<br><br>

고급 터미널
==============

* 운영 체제에서 제공하는 전형적인 터미널의 한가지 문제는 대량 데이터를 파이핑하여 출력할 때 대단히 느리다는 점이다

  * 예를 들어 MS 윈도의 터미널 윈도(cmd.exe)는 GDI를 이용해 문자를 렌더링하기 때문에 매우 느리다.

* 빠르게 동작해야 하는 금융 거래 환경에서는 하드웨어의 도움을 받아 렌더링을 한다.

* 문자들은 사전에 렌더링된 텍스쳐로 표현되어 OpenGL이나 Directx과 같은 그래픽 하드웨어용 API를 이용해 화면에 출력된다.

<br>

* 거래 터미널은 여러 개의 버퍼와 뷰포트로 이루어진다. 전형적인 경우 여러가지 거래, 교환 데아터들이 동시에 서로 다른 버퍼에서 업데이트된다.

  * 이 모든 정보가 하나의 화면에 표현되어야 한다.

<br>

* 버퍼는 단순한 선형 저장소를 넘어 다른 고급 기능들도 제공한다.

* 아래의 TableBuffer는 표 형태로 정리하여 출력하는 버퍼이다.

```c++
struct TableBuffer : IBuffer
{
    TableBuffer(vector<TableColumnSpec> spec,int totalHeight) { ... }

    struct TableColumnSpec
    {
        string header;
        int width;
        enum class TableColumnAlignment {
            Left, Center, Right
        } alignment;
    };
};
```

* 위 코드는 주어진 명세에 따라 데이터를 표로 정리하여 화면에 보여준다.

* 뷰포트는 버퍼로부터 데이터를 가져오는 역할을 한다.

* 다음은 뷰포트가 가지는 속성 중 일부이다.

    * 보여줄 버퍼로의 참조

    * 크기

    * 뷰포트가 버퍼보다 작으면 버퍼의 어느 부분을 보여줄지 지정해야 한다.
      * 이 부분은 x/y 절대 좌표로 표현된다.

    * 전체 콘솔 윈도에서 뷰포트의 위치

    * 커서의 위치. 현재 사용자의 입력을 받는다고 가정한다.

<br><br>

퍼사드는 어디에?
==============

* 예를 들고 있는 금융 거래 시스템에서는 콘솔 자체가 퍼사드이다.

* 콘솔 내부에서 많은 수의 서로 다른 객체들이 동작한다.

```c++
struct Console
{
  vector<Viewport*> viewports;
  Size charSize, gridSize;
};
```

* 콘솔의 초기화 작업은 일반적으로 대단히 복잡하고 손이 많이 간다.

* 그럼에도 불구하고 콘솔은 퍼사드이기 때문에 최대한 편리한 API를 제공하기 위해 노력해야 한다.

* 이를 위해 콘솔 내부의 모든 구성 요소를 초기화하는데 필요한 파라미터들을 직관적으로 이해하기 쉽게 정의한다.

```c++
Console::Console(bool fullscreen, int char_width, int char_height
                 int width, int height, optional<Size> client_size)
{
  //  구현부 예:
  //  버퍼와 뷰포트를 함께 묶어 생성하여 적절한 컬렉션 객체에 담기
  //  이미지 텍스쳐 생성
  //  전체 화면 모드 여부에 맞춰 그리드 크기 계산
}
```

* 다른 방법으로 모든 파라미터는 객체 하나에 묶어 전달할 수도 있다.

* 이렇게 하면 파라미터들의 적절한 디폴트 값을 한 곳에서 관리할 수 있다.

```c++
struct ConsoleCreationParameters
{
  optional<Size> client_size;
  int char_width{10};
  int char_height{14};
  int width{20};
  int height{30};
  bool fullscreen{false};
  bool create_default_view_and_buffer{true};
};
```

<br><br>

요약
================

* 퍼사드 디자인 패턴은 `하나 이상의 복잡한 서브 시스템 앞에 단순한 인터페이스를 두기 위한 방법`이다.

* 앞의 예에서, 다수의 버퍼와 다수의 뷰포트가 연동되는 복잡한 콘솔이든, 단일 버퍼에 단일 뷰포트만 존재하는 단순한 콘솔이든, 편리하고 직관적인 API를 통해 이용할 수 있게 한다.